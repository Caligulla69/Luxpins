<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= post.title %> - Luxpins</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              inter: ["Inter", "sans-serif"],
            },
            colors: {
              "blue-ncs": "#0094C6",
              "blue-premium": "#007AA3",
              "lapis-lazuli": "#005E7C",
              "deep-teal": "#004C63",
              "oxford-blue": "#000022",
              "soft-navy": "#0A0A2A",
              "rich-black": "#040F16",
              "rich-black-premium": "#0D1A22",
              "penn-blue": "#001242",
              "penn-blue-premium": "#0A1C3C",
            },
          },
        },
      };
    </script>
    <style>
      .masonry-grid {
        column-count: 4;
        column-gap: 20px;
        column-fill: balance;
      }

      @media (max-width: 1200px) {
        .masonry-grid {
          column-count: 3;
        }
      }
      @media (max-width: 768px) {
        .masonry-grid {
          column-count: 2;
        }
      }
      @media (max-width: 480px) {
        .masonry-grid {
          column-count: 1;
        }
      }

      .masonry-item {
        break-inside: avoid;
        margin-bottom: 20px;
        display: inline-block;
        width: 100%;
      }

      .pin-hover {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .pin-hover:hover {
        transform: translateY(-4px);
        box-shadow: 0 20px 40px rgba(0, 148, 198, 0.15);
      }

      .overlay-gradient {
        background: linear-gradient(
          180deg,
          rgba(0, 0, 0, 0) 0%,
          rgba(0, 0, 0, 0.6) 100%
        );
      }

      .floating-nav {
        backdrop-filter: blur(20px);
        background: rgba(255, 255, 255, 0.9);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .premium-btn {
        background: linear-gradient(135deg, #0094c6 0%, #007aa3 100%);
        transition: all 0.3s ease;
      }

      .premium-btn:hover {
        box-shadow: 0 10px 30px rgba(0, 148, 198, 0.3);
        transform: translateY(-2px);
      }

      .glass-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }
    </style>
  </head>
  <body class="bg-gray-50 font-inter">
    <%- include('navbar') %>

    <!-- Main Pinterest Layout -->
    <main class="container mx-auto px-4 pt-20 pb-12">
      <!-- Main Pin (Featured Post) -->
      <div class="max-w-4xl mx-auto mt-10 mb-12">
        <div class="bg-white rounded-3xl overflow-hidden shadow-lg pin-hover">
          <!-- Image Section -->
          <% if (post.image) { %>
          <div class="relative group">
            <img
              src="<%= post.image %>"
              alt="<%= post.title %>"
              class="w-full h-auto object-cover"
            />

            <!-- Floating Board Tag -->
            <% if (board && board.name) { %>
            <div class="absolute top-4 left-4">
              <span
                class="bg-white/90 backdrop-blur-sm text-blue-ncs px-4 py-2 rounded-full text-sm font-medium shadow-sm border border-blue-100"
              >
                <%= board.name %>
              </span>
            </div>
            <% } %>

            <!-- Floating Actions -->
            <div
              class="absolute top-4 right-4 flex space-x-2 opacity-0 group-hover:opacity-100 transition-all duration-300"
            >
              <button
                class="w-10 h-10 bg-white/90 backdrop-blur-sm rounded-full flex items-center justify-center shadow-sm hover:bg-white transition-colors hover:scale-110"
              >
                <i
                  class="fas fa-heart text-gray-700 text-sm hover:text-red-500"
                ></i>
              </button>
              <button
                class="w-10 h-10 bg-white/90 backdrop-blur-sm rounded-full flex items-center justify-center shadow-sm hover:bg-white transition-colors hover:scale-110"
              >
                <i
                  class="fas fa-share text-gray-700 text-sm hover:text-blue-ncs"
                ></i>
              </button>
              <button
                class="w-10 h-10 bg-white/90 backdrop-blur-sm rounded-full flex items-center justify-center shadow-sm hover:bg-white transition-colors hover:scale-110"
              >
                <i
                  class="fas fa-bookmark text-gray-700 text-sm hover:text-blue-ncs"
                ></i>
              </button>
            </div>
          </div>
          <% } %>

          <!-- Content Section -->
          <div class="p-8">
            <!-- Title -->
            <h1
              class="text-3xl md:text-4xl font-bold text-rich-black mb-6 leading-tight"
            >
              <%= post.title %>
            </h1>

            <!-- Description -->
            <% if (post.description) { %>
            <p
              class="text-gray-700 text-lg leading-relaxed mb-8 whitespace-pre-wrap"
            >
              <%= post.description %>
            </p>
            <% } %>

            <!-- Author Info -->
            <div
              class="flex items-center justify-between pt-6 border-t border-gray-100"
            >
              <div class="flex items-center">
                <div
                  class="w-12 h-12 bg-gradient-to-br from-blue-ncs to-blue-premium rounded-2xl flex items-center justify-center mr-4"
                >
                  <span class="text-white font-semibold">
                    <%= user.username ?
                    user.username.charAt(0).toUpperCase() : 'U' %>
                  </span>
                </div>
                <div>
                  <p class="font-semibold text-rich-black">
                    <%= user.username || 'Anonymous' %>
                  </p>
                  <p class="text-gray-500 text-sm">
                    <%= new Date(post.createdAt).toLocaleDateString('en-US', {
                    month: 'long', day: 'numeric', year: 'numeric' }) %>
                  </p>
                </div>
              </div>

              <div class="flex items-center space-x-4">
                <button
                  class="flex items-center space-x-2 text-gray-600 hover:text-red-500 transition-colors px-3 py-2 rounded-lg hover:bg-red-50"
                >
                  <i class="far fa-heart"></i>
                  <span>24</span>
                </button>
                <button
                  class="flex items-center space-x-2 text-gray-600 hover:text-blue-ncs transition-colors px-3 py-2 rounded-lg hover:bg-blue-50"
                >
                  <i class="far fa-comment"></i>
                  <span>8</span>
                </button>
                <button
                  class="premium-btn text-white px-6 py-2 rounded-full font-medium"
                >
                  Follow
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Related Pins Section -->
      <% if (board && board.posts && board.posts.length > 1) { %>
      <section class="mb-8">
        <div class="text-center mb-8">
          <h2 class="text-3xl font-bold text-rich-black mb-2">
            More like this
          </h2>
          <p class="text-gray-600 text-lg">
            From
            <span class="text-blue-ncs font-semibold"><%= board.name %></span>
            collection
          </p>
        </div>

        <!-- Pinterest Masonry Grid -->
        <div class="masonry-grid">
          <% board.posts.filter(p => p._id.toString() !==
          post._id.toString()).forEach((relatedPost, index) => { %>
          <div class=" pin-card">
            <div
              class="bg-white rounded-2xl overflow-hidden shadow-sm pin-hover cursor-pointer group"
            >
              <!-- Image -->
              <div class="relative overflow-hidden">
                <% if (relatedPost.image) { %>
                <img
                  src="<%= relatedPost.image %>"
                  alt="<%= relatedPost.title %>"
                  class="w-full h-auto object-cover group-hover:scale-105 transition-transform duration-500"
                />
                <% } else { %>
                <div
                  class="aspect-[3/4] bg-gradient-to-br from-blue-50 to-blue-100 flex items-center justify-center"
                >
                  <i class="fas fa-image text-blue-300 text-3xl"></i>
                </div>
                <% } %>

                <!-- Overlay on Hover -->
                <div
                  class="absolute inset-0 overlay-gradient opacity-0 group-hover:opacity-100 transition-opacity duration-300"
                >
                  <div class="absolute bottom-4 left-4 right-4">
                    <div class="flex items-center justify-between">
                      <button
                        class="w-9 h-9 bg-white rounded-full flex items-center justify-center shadow-lg hover:scale-110 transition-transform"
                      >
                        <i class="fas fa-heart text-red-500 text-sm"></i>
                      </button>
                      <button
                        class="w-9 h-9 bg-white rounded-full flex items-center justify-center shadow-lg hover:scale-110 transition-transform"
                      >
                        <i class="fas fa-share text-blue-ncs text-sm"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Content -->
              <div class="p-4">
                <h3
                  class="font-semibold text-rich-black group-hover:text-blue-ncs transition-colors line-clamp-2 mb-2 leading-snug text-sm"
                >
                  <%= relatedPost.title %>
                </h3>

                <% if (relatedPost.description && relatedPost.description.length
                > 0) { %>
                <p
                  class="text-gray-600 text-xs line-clamp-3 mb-3 leading-relaxed"
                >
                  <%= relatedPost.description.substring(0, 80) %><%=
                  relatedPost.description.length > 80 ? '...' : '' %>
                </p>
                <% } %>

                <!-- Mini Author -->
                <div class="flex items-center justify-between">
                  <div class="flex items-center">
                    <div
                      class="w-6 h-6 bg-gradient-to-br from-blue-ncs to-blue-premium rounded-full flex items-center justify-center mr-2"
                    >
                      <span class="text-white font-medium text-xs">
                        <%= relatedPost.author.username ?
                        relatedPost.author.username.charAt(0).toUpperCase() :
                        'U' %>
                      </span>
                    </div>
                    <span class="text-gray-600 text-xs font-medium">
                      <%= relatedPost.author.username || 'Anonymous' %>
                    </span>
                  </div>

                  <div class="flex items-center space-x-1 text-gray-400">
                    <i class="far fa-heart text-xs"></i>
                    <span class="text-xs"
                      ><%= Math.floor(Math.random() * 50) + 5 %></span
                    >
                  </div>
                </div>
              </div>
            </div>
          </div>
          <% }); %>
        </div>
      </section>
      <% } %>
    </main>

    <!-- Floating Action Button -->
    <div class="fixed bottom-8 right-8">
      <a
        href="/postUpload"
        class="w-14 h-14 premium-btn rounded-full shadow-xl flex items-center justify-center transition-all hover:scale-110"
      >
        <i class="fas fa-plus text-white text-xl"></i>
      </a>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Enhanced like functionality with animation
        document.querySelectorAll(".fa-heart").forEach((heartIcon) => {
          heartIcon.closest("button").addEventListener("click", function (e) {
            e.preventDefault();
            const icon = this.querySelector("i");
            const isLiked = icon.classList.contains("fas");

            if (isLiked) {
              icon.classList.remove("fas");
              icon.classList.add("far");
              icon.classList.remove("text-red-500");
              icon.classList.add("text-gray-700");
            } else {
              icon.classList.remove("far");
              icon.classList.add("fas");
              icon.classList.remove("text-gray-700");
              icon.classList.add("text-red-500");

              // Heart animation
              this.style.animation = "pulse 0.3s ease-in-out";
              setTimeout(() => {
                this.style.animation = "";
              }, 300);
            }
          });
        });

        // Share functionality
        document.querySelectorAll(".fa-share").forEach((shareIcon) => {
          shareIcon.closest("button").addEventListener("click", function (e) {
            e.preventDefault();
            if (navigator.share) {
              navigator.share({
                title: document.title,
                url: window.location.href,
              });
            } else {
              // Fallback to copy URL
              navigator.clipboard.writeText(window.location.href).then(() => {
                // Visual feedback
                const original = this.innerHTML;
                this.innerHTML =
                  '<i class="fas fa-check text-green-500 text-sm"></i>';
                setTimeout(() => {
                  this.innerHTML = original;
                }, 2000);
              });
            }
          });
        });

        document.querySelectorAll(".pin-card").forEach((card) => {
          card.addEventListener("click", (e) => {
            // Don't navigate if save button was clicked
            if (e.target.classList.contains("save-btn")) return;

            const postId = card.dataset.postId;
            console.log("Pin clicked:", postId);

            // Navigate to pin detail page
            window.location.href = `/pin/${postId}`;
          });
        });

        // Related pin navigation
        document
          .querySelectorAll(".masonry-item .cursor-pointer")
          .forEach((pin) => {
            pin.addEventListener("click", function () {
              // Add loading state
              this.style.opacity = "0.7";
              // Navigation would happen here in actual implementation
              console.log("Navigate to related pin");
            });
          });

        // Lazy loading effect for masonry items
        const observerOptions = {
          threshold: 0.1,
          rootMargin: "50px",
        };

        const observer = new IntersectionObserver((entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.style.opacity = "1";
              entry.target.style.transform = "translateY(0)";
              observer.unobserve(entry.target);
            }
          });
        }, observerOptions);

        // Apply lazy loading to masonry items
        document.querySelectorAll(".masonry-item").forEach((item, index) => {
          item.style.opacity = "0";
          item.style.transform = "translateY(20px)";
          item.style.transition = "opacity 0.6s ease, transform 0.6s ease";
          item.style.transitionDelay = `${index * 0.1}s`;
          observer.observe(item);
        });

        // Parallax effect for floating header
        let ticking = false;
        function updateHeader() {
          const scrolled = window.pageYOffset;
          const header = document.querySelector("header");
          if (header) {
            const opacity = Math.max(0.9 - scrolled / 500, 0.7);
            header.style.backgroundColor = `rgba(255, 255, 255, ${opacity})`;
          }
          ticking = false;
        }

        window.addEventListener("scroll", function () {
          if (!ticking) {
            requestAnimationFrame(updateHeader);
            ticking = true;
          }
        });
      });

      // Add CSS animation for heart pulse
      const style = document.createElement("style");
      style.textContent = `
            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.2); }
                100% { transform: scale(1); }
            }
        `;
      document.head.appendChild(style);
    </script>
  </body>
</html>
